{% extends 'base.html' %}

{% block content %}

<br>
<h3 class="text-center">Red Team Report Details</h3>

<div class="col-8 offset-2">
    <div>
        <span><strong>Status:</strong></span>
        {% if rtr.status == 0 %}
        <span class="text-success"><strong>Complete</strong></span>
        {% elif rtr.status == 1 %}
        <span class="text-primary"><strong>Pending</strong></span>
        {% elif rtr.status == 2 %}
        <span class="text-warning"><strong>Awaiting Approval</strong></span>
        {% elif rtr.status == 3 %}
        <span class="text-danger"><strong>Denied</strong></span>
        {% endif %}
    </div>
    <div>
        <span><strong>Submission Time:</strong></span>
        <span>{{ rtr.submitted }}</span>
    </div>
    <div>
        <span><strong>Completion Time:</strong></span>
        <span>
        {% if rtr.completed is none %}
        -
        {% else %}
        {{ rtr.completed }}
        {% endif %}
    </div>
        <div>
        <span><strong>System:</strong></span>
        <span>{{ rtr.system_id }}</span>
        </div>
        <div>
        <span><strong>Type of breach:</strong></span>
        <span>{{ rtr.btype }}</span>
        </div>
        <div>
        <span><strong>Point penalty:</strong></span>
        <span>{{ rtr.point_penalty }}</span>
    </div>

</div>

<div class="col-8 offset-2 mt-2">
<table class="table table-striped table-bordered">
    <thead class="thead-dark">
        <th class="col-4">Description</th>
    </thead>
    <tbody>
        <tr>
            <td>{{ rtr.description }}</td>
        </tr>
    </tbody>
</table>
</div>

<script>
function textAreaAdjust(o) {
  o.style.height = "1px";
  var sh = o.scrollHeight;
  o.style.height = (sh+25) + "px";
  var cont = document.getElementById('comment_container');
  cont.style.height = (sh+75) + "px";
}

window.onload = function () {
    var elem = document.getElementById('admin_comment');
    if (elem != null) {
        textAreaAdjust(elem);
    }
    var elem = document.getElementById('team_comment');
    if (elem != null) {
        textAreaAdjust(elem);
    }
}
</script>

<form method="post" action="rtr_details">
    <div>
        <br>
        <span class=""><strong><u>Admin Comments</u></strong></span>
        {% if current_user.is_admin %}
        <textarea name="admin_comment" id="admin_comment" class="col-12" style="height:100%; resize:none;" onkeyup="textAreaAdjust(this)">{{ rtr.admin_comment }}</textarea>
        {% else %}
        <p class="">{{ rtr.admin_comment }}</p>
        {% endif %}
        <br>
    </div>
    <br>
    <input type="hidden" id="reqId" name="reqId" value="{{rtr.id}}"/>
    {% if current_user.is_admin %}
    {% if rtr.status == 1 or rtr.status == 2 %}
    <div class="jusitfy-content-center">
        <div class="col-6 float-right">
            <input type="submit" name="approval" value="Deny" class="mt-1 mb-5 col-12 btn btn-danger"/>
        </div>
        <div class="col-6">
            <input type="submit" name="approval" value="Approve" class="mt-1 mb-5 col-12 btn btn-success"/>
        </div>
    </div>
    {% endif %}

    <div class="col-12">
        <input type="submit" value="Save Comments" class="col-12 btn btn-success"/>
    </div>
    {% endif %}   
</form>

{% endblock %}
